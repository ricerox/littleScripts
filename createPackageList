#!/usr/bin/env bash

#
# Create a list of all ("manually") installed packages
# Author: pixELSflash
# License: MIT
# Repo: https://github.com/pixELSflash/littleScripts/
#

# cron executes this as the user so $HOME is actually set
installedPackagesFile="${HOME}/.installed-packages"
[[ ! -f "${installedPackagesFile}" ]] && touch "${installedPackagesFile}"

lastTime="$(head -n1 "${installedPackagesFile}")"
today="$(date --iso-8601)"

if [[ ${lastTime} !=  "${today}" ]]; then
    {
        echo -e "${today}\n=========="

        echo -e "apt\n----------"
        LANG=C apt list --manual-installed | tail -n+2

        echo -e "----------\npip\n----------"
        LANG=C pip freeze

        echo -e "----------\nflatpak\n----------"
        LANG=C flatpak list --app

    } >"${installedPackagesFile}"
fi
